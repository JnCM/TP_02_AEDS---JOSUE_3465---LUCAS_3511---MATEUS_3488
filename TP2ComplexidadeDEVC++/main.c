#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include "Funcoes.h"

int main(){
    int Opcao=1;
    int i, j, num, cont;
    int N, X, Menor_Dist;
    clock_t TempFinal, TempInicial;
    double Tempo_ms, Tempo_seg, Tempo_min, Tempo_hrs;
    char Matricula1[5], Matricula2[5], Matricula3[5];
    while(Opcao != 0){
        printf("=======================================================================================================\n");
        printf("Digite qual opcao voce deseja:\n");
        printf("0 - Sair\n");
        printf("1 - Arquivo\n");
        printf("2 - Iterativo\n");
        printf("=======================================================================================================\n");
        scanf("%d", &Opcao);
        if(Opcao == 1){
            FILE *Arquivo;
            char NomeArquivo[100];
            printf("=======================================================================================================\n");
            printf("Digite o nome do Arquivo com sua Extensao:\n");
            scanf("%s", NomeArquivo);
            Arquivo = fopen(NomeArquivo, "r");
            fscanf(Arquivo, "%s", Matricula1);
            fscanf(Arquivo, "%s", Matricula2);
            fscanf(Arquivo, "%s", Matricula3);
            fscanf(Arquivo, "%d", &N);
            int MatrizDist[N][N];
            int VetorPos[N-1], MelhorCam[N-1];
            cont = 0;
            for(i=1; i<=N; i++){
                for(j=1; j<=N; j++){
                    if(i==j){
                        MatrizDist[i][j] = 0;
                    }
                    else{
                        fscanf(Arquivo, "%d", &MatrizDist[i][j]);
                    }
                }
            }
            fclose(Arquivo);
            CalculaX(&X, Matricula1, Matricula2, Matricula3, N);
            PreencheVetor(VetorPos, X, N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            ImprimeMatricula(Matricula1, Matricula2, Matricula3);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Quantidade de cidades: %d\n", N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Cidade Inicial: %d\n", X);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            TempInicial = clock();
            permuta(X, VetorPos, 1, N-1, N, MatrizDist, MelhorCam, &Menor_Dist, &cont);
            TempFinal = clock();
            Tempo_ms = (TempFinal - TempInicial) * 1000.0 / CLOCKS_PER_SEC;
            CalculaTempo(Tempo_ms, &Tempo_seg, &Tempo_min, &Tempo_hrs);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Matriz de Distancia:\n");
            printf("=======================================================================================================\n");
            ImprimeMatriz(N, MatrizDist);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("A menor distancia foi: %d\n", Menor_Dist);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Sequencia de cidades percorridas: ");
            ImprimeCam(MelhorCam, X, N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            ImprimeTempo(Tempo_ms, Tempo_seg, Tempo_min, Tempo_hrs);
            printf("=======================================================================================================\n");
        }
        else if(Opcao == 2){
            printf("=======================================================================================================\n");
            printf("Digite as Matriculas:\n");
            scanf("%s", Matricula1);
            scanf("%s", Matricula2);
            scanf("%s", Matricula3);
            printf("=======================================================================================================\n");
            printf("Digite a quantidade de cidades:\n");
            scanf("%d", &N);
            while(N<1){
               printf("Digite uma quantidade maior que 1:\n");
               scanf("%d", &N);
            }
            printf("=======================================================================================================\n");
            int MatrizDist[N][N];
            int VetorPos[N-1], MelhorCam[N-1];
            num = 0;
            cont = 0;
            for(i=1; i<=N; i++){
               for(j=1; j<=N; j++){
                   if(i==j){
                       MatrizDist[i][j] = 0;
                   }
                   else{
                       num = rand()%100;
                       while(num==0){
                           num = rand()%100;
                       }
                       MatrizDist[i][j] = num;
                   }
               }
            }
            CalculaX(&X, Matricula1, Matricula2, Matricula3, N);
            PreencheVetor(VetorPos, X, N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            ImprimeMatricula(Matricula1, Matricula2, Matricula3);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Quantidade de cidades: %d\n", N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Cidade Inicial: %d\n", X);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            TempInicial = clock();
            permuta(X, VetorPos, 1, N-1, N, MatrizDist, MelhorCam, &Menor_Dist, &cont);
            TempFinal = clock();
            Tempo_ms = (TempFinal - TempInicial) * 1000.0 / CLOCKS_PER_SEC;
            CalculaTempo(Tempo_ms, &Tempo_seg, &Tempo_min, &Tempo_hrs);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Matriz de Distancia:\n");
            printf("=======================================================================================================\n");
            ImprimeMatriz(N, MatrizDist);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("A menor distancia foi: %d\n", Menor_Dist);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            printf("Sequencia de cidades percorridas: ");
            ImprimeCam(MelhorCam, X, N);
            printf("=======================================================================================================\n");
            printf("=======================================================================================================\n");
            ImprimeTempo(Tempo_ms, Tempo_seg, Tempo_min, Tempo_hrs);
            printf("=======================================================================================================\n");
        }
	}
    return 0;
}
